**表结构设计文档**

**一、文档说明**

文档目的：明确智能烟感系统新增数据表的字段定义、类型及索引设计，确保数据存储符合业务需求与协议规范。

参考来源：仅摘抄《03 模块化拓展架构设计文档.docx》《04
智能烟感技术方案设计文档.docx》原文，无新增或改写内容。

**二、新增数据表**

**2.1 sensor_extend（传感器扩展信息表）**

  -------------------------- --------------- --------------- ----------------------------------
  字段名                     类型            长度            说明

  sensor_id                  VARCHAR         32              主键（IMEI号，Tag0x65）

  material_code              VARCHAR         64              物料编码（固定JTY-GD-TCN2010）

  installation_location      VARCHAR         255             安装位置

  area_id                    BIGINT          \-              所属区域ID

  area_name                  VARCHAR         64              所属区域名称

  iccid                      VARCHAR         32              SIM卡ID（Tag0x70，BCD\[10\]）

  module_version             VARCHAR         64              通信模组版本（Tag0x67）

  module_vendor              VARCHAR         32              模组厂商（Tag0x68，如利尔达=03）

  terminal_type              TINYINT         \-              终端类型（固定0x98，Tag0x03）

  normal_work_interval       INT             \-              正常上报间隔（秒，Tag0x06）

  emergency_alarm_interval   INT             \-              紧急报警间隔（秒，Tag0x08）

  smoke_threshold            INT             \-              烟雾阈值（%，Tag0x14）

  temp_upper_limit           TINYINT         \-              温度上限（℃，Tag0x0B）

  temp_lower_limit           TINYINT         \-              温度下限（℃，Tag0x21）

  battery_life               VARCHAR         16              电池寿命（固定3年）

  protection_level           VARCHAR         8               防护等级（固定IP30）
  -------------------------- --------------- --------------- ----------------------------------

**2.2 sensor_contact（传感器联系人表）**

  -------------------- -------------------- ----------------------
  字段名               类型                 说明

  id                   BIGINT               主键

  sensor_id            VARCHAR(32)          传感器IMEI号

  user_id              BIGINT               联系人用户ID

  phone                VARCHAR(20)          联系电话

  notify_type          TINYINT              通知类型（1-语音
                                            2-短信）

  priority             TINYINT              通知优先级（1-最高）
  -------------------- -------------------- ----------------------

**2.3 notification_quota（通知额度表）**

  -------------------- -------------------- ----------------------
  字段名               类型                 说明

  id                   BIGINT               主键

  sensor_id            VARCHAR(32)          传感器IMEI号（主键）

  free_voice_count     INT                  剩余免费语音条数

  free_sms_count       INT                  剩余免费短信条数

  balance              DECIMAL(10,2)        账户余额
  -------------------- -------------------- ----------------------

**2.4 sensor_alarm_log（传感器报警日志表）**

  --------------- --------------- --------------- --------------------------------------------
  字段名          类型            长度            说明

  id              BIGINT          \-              主键

  sensor_id       VARCHAR         32              传感器IMEI

  alarm_type      TINYINT         \-              报警类型（1=火灾，2=温度，3=低电，4=防拆）

  trigger_tag     TINYINT         \-              触发报警的协议Tag（0x01/0x02）

  trigger_value   VARCHAR         32              触发值（如"烟雾浓度:120%"）

  alarm_time      DATETIME        \-              报警时间

  handle_status   TINYINT         \-              处理状态（0=未处理，1=已处理）

  handle_time     DATETIME        \-              处理时间（如消音时间）

  handle_user     VARCHAR         32              处理人（用户名）
  --------------- --------------- --------------- --------------------------------------------

**2.5 sys_notification_template（通知模板表）**

  -------------------- -------------------- ----------------------------
  字段名               类型                 说明

  id                   bigint               主键

  product_id           bigint               关联产品ID（实现模板复用）

  sign_name            varchar              短信签名（阿里云）

  template_code        varchar              短信模板CODE（阿里云）

  template_id          varchar              语音模板ID（腾讯云）

  create_time          datetime             创建时间
  -------------------- -------------------- ----------------------------

**2.6 iot_import_log（导入日志表）**

  -------------------- -------------------- --------------------------------
  字段名               类型                 说明

  id                   bigint               主键

  import_user          varchar              导入人

  import_time          datetime             导入时间

  success_count        int                  成功数量

  fail_count           int                  失败数量

  fail_reason          text                 失败原因（如"IMEI=xxx已存在"）

  file_name            varchar              导入文件名
  -------------------- -------------------- --------------------------------

**2.7 sys_role_area（角色区域关联表）**

  -------------------- -------------------- --------------------
  字段名               类型                 说明

  id                   bigint               主键

  role_id              bigint               角色ID

  area_id              bigint               区域ID
  -------------------- -------------------- --------------------

**2.8 iot_threshold_log（阈值调整日志表）**

  -------------------- -------------------- -------------------------
  字段名               类型                 说明

  id                   bigint               主键

  sensor_id            varchar              传感器IMEI

  threshold_type       varchar              阈值类型（如"battery"）

  old_value            varchar              旧值

  new_value            varchar              新值

  operate_user         varchar              操作人

  operate_time         datetime             操作时间
  -------------------- -------------------- -------------------------

**三、索引设计**

  -------------------- --------------- ------------------------- ------------------------------
  数据表名             索引类型        索引字段                  说明

  sensor_extend        主键索引        sensor_id                 唯一标识传感器

  sensor_extend        普通索引        area_id                   支持按区域筛选

  sensor_extend        联合索引        sensor_id+terminal_type   快速定位设备类型

  sensor_contact       普通索引        sensor_id                 关联传感器查询联系人

  sensor_contact       普通索引        user_id                   关联用户查询联系人

  sensor_contact       联合索引        sensor_id+priority        快速查询高优先级联系人

  notification_quota   主键索引        sensor_id                 唯一关联传感器

  notification_quota   普通索引        free_voice_count          快速定位语音额度不足的传感器

  notification_quota   普通索引        free_sms_count            快速定位短信额度不足的传感器

  sensor_alarm_log     普通索引        sensor_id                 关联传感器查询报警日志

  sensor_alarm_log     联合索引        alarm_time+alarm_type     支持按时间+报警类型筛选

  iot_import_log       普通索引        import_time               按导入时间筛选日志

  iot_import_log       普通索引        import_user               按导入人筛选日志

  sys_role_area        联合索引        role_id+area_id           关联角色与区域权限
  -------------------- --------------- ------------------------- ------------------------------
